# Communicating with server

- How to render a data collection, like a list of names, to the screen.

- How to submit data to a React application using HTML forms.

- How JS code in the browser can fetch and handle data stored in a remote
  backend server.

- How to add CSS styles to our React applications.

---

## a. Rendering a collection, modules

#### console.log

- When something does not work, log or use some other way of debugging.

```javascript
console.log("props value is", props);
```

#### JS arrays

React using functional programming methods of JS array, such as `find`,
`filter`, and `map`.

#### Rendering collections

Instead of render _objects in an array_ by referring to a hard-coded index
number

```javascript
<li> {note[1].content}</li>
```

A more approriate to generate React-elements from the array objects is using the
`map` function.

```javascript
notes.map(note => <li> {note.content}</li>);
```

#### Key-attribute

Each items in a list, i.e. the element generated by the `map` method, must have
a unique key value.

```javascript
{
  notes.map(note => <li key={note.id}>{note.content}</li>);
}
```

React uses the `key` attributes of objects in an array to determine how to
update the view generated by a component when the component is re-rendered.

#### Map

`Map` creates a new array, the elements of which have been created from the
elements of the original array by mapping, using the function given as a
parameter to the map method.

#### Anty-pattern: array indexes as keys

In the case where the unique key value is unavailable, we can use the array
indexes as key. The indexes can be retrieved by passing a second parameter to
the map method

```javascript
notes.map((note, i) => <li key={i}> {note.content}</li>);
```

When call like this, `i` is assigned the value of the index of the position in
the array where the Note resides.

This tricks is **unsafe** because React uses `key` attribute as a way to
identify DOM element. When a new element push to the list or remove a section of
an array, the key is remain in the same order but the component is not.

We can use array indexes as keys when

- the list and items are static
- the items in the list have no ids
- the list is never reordered or filtered

#### Reduce

The `reduce()` method executes a **reducer** function on each element of the
array, resulting in a single output value.

## b. Forms

## c. Getting data from server

`JSON server` generates fake REST API server for learning.

run `npx json-server --port 3001 --watch db.json` to running on port 3001. It will the data is int the json format when opens the `http://localhost:3001/notes`.

The idea of server, in this practice is to save the notes to the server, json-server. The React code fetches the notes from the server and renders them to the screen. When a new notes added to the app, it will send to the server to update the json.

##### The browsers as a runtime environment

One way to fetch the data from the server is using `XMLHttpRequest`, HTTP request using XHR object. This technique introduced in 1999 and supported for a good while now. It is not recommended to use this technique anymore.

`fetch` promise based function is standardized and support by all modern browser.

`axios` library functions like `fetch` but it more pleasant to use. `npm i axios`.

```node
npm install axios --save
npm install json-server --save-dev
```

`--save` installed as a runtime dependency of the application, because the execution of the program requires the existence of the library.

`--save-dev` installed as a development dependency since the program itself doesn't require it, used for assistance during software development.

#### Axios and promises

`import` statement to bring the library into the React component.

Axios method `get` returns a **promise**. A promise is an object representing the eventual completion or faulture of an async operation.It means a promise is an object that represent an async operation.

- The promise is pending - the final value is not available yet.
- The promise is fulfulled - is completed and final value is available - successful operation, aka _resolved_.
- The promise is rejected - error in the

If, and when, we want to access the result of the operation represented by the promise, we must register an event handler to the promise.

```javascript
const promise = axios.get("http://localhost:3001/notes");

promise.then(response => {
  console.log(response);
});
```

JS calls the callback function registered by the `then` method providing it with a `response` object as a parameter.
The `response` object contains all the essential data related to the respone of an HTTP GET request.

Store the promise object in a variable is unnecessary, better to chain the `then` method call to the axios call.

```javascript
const promise = axios.get("http://localhost:3001/notes").then(response => {
  const notes = response.data;
  console.log(notes);
});
```

#### Effect-hooks

> The Effect Hooks lests you perform side effects in function components. Data fetching, setting up a subscription, and manually changing the DOM in React components are examples of side effects.

```javascript
import React, { useState, useEffect } from "react";
```

The effect is executed immediately after rendering.

```javascript
useEffect(() => {
  console.log("effect");
  axios.get("http://localhost:3001/notes").then(response => {
    console.log("promise fulfilled");
    setNotes(response.data);
  });
}, []);
```

When the data arrives from the server, the JS call the function registered as the event handler.

The `useEffect` takes two parameters - the effect itself, and the empty array `[]` specify how oftern the effect is run.

By default, effects run after every completed render.

#### The development runtime enviroment

The JavaScript code making up our React application is run in the browser. The browser gets the Javascript from the React dev server, which is the application that runs after running the command npm start. The dev-server transforms the JavaScript into a format understood by the browser. Among other things, it stitches together Javascript from different files into one file. We'll discuss the dev-server in more detail in part 7 of the course.

The React application running in the browser fetches the JSON formatted data from json-server running on port 3001 on the machine. json-server gets its data from the file db.json.

## d. Altering data in server

In REST terminology, we refer to individual data objects such as the notes in application as _resources_. Each resources has a unique address associated with the URL.

Resources are fetched from the server with HTTP GET requests.
HTTP GET request to the URL notes/3 will return the note that has the id number 3.

HTTP POST request is to create a new resource for storing a note.

The new note consists of a new note object is returned by the backend server is added to the list of notes in the app's state.

#### Extract backend into a separate module

Create a src/services directory and a services.js file contains all the function that related to the server such as getAll, create, and update where it will fetch a GET or a POST HTTP request to the server.

```javascript
import axios from "axios";
const baseUrl = "http://localhost:3001/notes";

const getAll = () => {
  return axios.get(baseUrl);
};

const create = newObject => {
  return axios.post(baseUrl, newObject);
};

const update = (id, newObject) => {
  return axios.put(`${baseUrl}/${id}`, newObject);
};

export default {
  getAll: getAll,
  create: create,
  update: update
};
```

The module returns an object that has three functions as its properties. The functions directly returned by the axios method.

## e. Adding styles to React app
